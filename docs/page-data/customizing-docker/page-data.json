{
    "componentChunkName": "component---src-pages-customizing-docker-mdx",
    "path": "/customizing-docker/",
    "result": {"pageContext":{"frontmatter":{"title":"Customizing Workflow Process Service Trial on Docker"},"relativePagePath":"/customizing-docker.mdx","titleType":"page","MdxNode":{"id":"50550e4f-21ed-547b-8fe6-43e513e5801b","children":[],"parent":"03cf611f-5e65-57f5-ae22-413077d647ac","internal":{"content":"---\ntitle: Customizing Workflow Process Service Trial on Docker\n---\n\n## Table of contents\n- [Customizing the hostname and port](#customizing-the-hostname-and-port)\n- [Changing the admin password](#changing-the-admin-password)\n- [Persisting your data](#persisting-your-data)\n- [Customizing the user registry](#customizing-the-user-registry)\n- [Enabling full text search and dashboard support](#enabling-full-text-search-and-dashboard-support)\n- [Cleaning up the environment](#cleaning-up-the-environment)\n- [Overriding the Liberty default configuration](#overriding-the-liberty-default-configuration)\n- [Integrating with external services](#integrating-with-external-services)\n\n\n## Customizing the hostname and port\n\nIf you want to access Workplace or Studio from a web browser that's not running on the Docker host, edit the  `docker-compose.yml` file to set the `EXTERNAL_HOSTNAME` environment variable to the actual IP or hostname of your Docker host. \n\nYou can also customize the external port used to expose the Workflow Process Service APIs. If you want to change the external port, you can't use localhost as the `EXTERNAL_HOSTNAME`. To change the external port, take both of these two actions:\n\n   1. Set the `EXTERNAL_HTTPS_PORT` environment variable in the `docker-compose.yml` file to the port number of your choice.\n   2. Change the host port declared in the `services.pc.ports` section to make it match the `EXTERNAL_HTTPS_PORT` environment variable value. \n   \n   For example, to set the host port to 7443:\n\n  ```\n  \n  [...]\n    pc:\n      [...]\n      ports:\n        - \"7443:9443\"\n      [...]\n      environment:\n      [...]\n        - EXTERNAL_HTTPS_PORT=7443\n  [...]\n  ```\n\n  The `EXTERNAL_HTTPS_PORT` is the first number under `ports` in the docker-compose.yml file:\n\n  ```\n  ports:\n        - \"7443:9443\"\n  ```\n\nAfter updating `EXTERNAL_HOSTNAME` or `EXTERNAL_HTTPS_PORT` in the `docker-compose.yml` file, if you already had an existing environment, follow these steps for the change to take effect:\n\n1. Run the  `docker-compose down` command to stop and delete the environment.\n2. If you are using persistent data, delete the `tls` folder in your workspace and `tls` folder under data/generated/ in your workspace.\n3. Run the  `docker-compose up` command to start the environment. \n\n**Note:** The container will use the same DNS server as the host computer, but the hostname and IP mappings in the /etc/hosts file won't be passed to the container automatically. If the hostname of your host machine is not added to the DNS server, you can configure the container to use the hostname and IP mappings by adding information similar to the following information in the docker-compose.yml file:\n\n  ```\n  #############################################################################################################\n  # The \"pc\" container is running the Workflow Process Service (authoring trial) image\n  #############################################################################################################\n  pc:\n    ...\n\n    extra_hosts:\n      - <hostname>:<host_ipaddress>\n  ```\n\n## Changing the admin password\n\nIf you don't want to use the default admin password for the Docker image, add the following line under the `environment` section in the `docker-compose yml` file before you start the environment:\n\n```    \n    - ADMIN_PASSWORD=<your_password>\n```\n\nReplace `<your_password>` with your new password. \n\n **Note:**  You can't change the admin username. \n\n#### Updating the admin password after starting\n\nTo update the admin password, you must restart the container because the Liberty server environment is not refreshed dynamically.\n\nIf you have an existing environment and you updated the `ADMIN_PASSWORD` variable in the `docker-compose.yml` file, complete the following steps:\n\n1. Run the `docker-compose down` command to stop and delete the environment.\n2. If you enabled persistence, find the `server.env` file under the env/ folder and delete the whole line that starts with `ADMIN_PASSWORD`.\n3. Run the  `docker-compose up` command to start the environment.\n\n## Persisting your data\n\nIf you want to save the data and the process when you delete the container instance, and reuse it when you run another container instance, you can persist the data. Copy the contents of the [docker-compose.yml](https://github.com/icp4a/workflow-process-service-trial/blob/main/persistence/basic/docker-compose.yml) file with persistence to your local computer.\n\n#### For Linux only\n\nIf you're running Linux and using Docker as your container engine, make sure the folder has read-write permission from the container. The container user ID is 50001 and it belongs to the root group, so to change the folder's permissions, run:\n\n```\nsudo chown 50001:0 <current_sample_folder>\n```\n\n **Note:**  Don't run this command on Mac. It's only needed for Linux.\n\n#### For Windows only\nEdit the `docker-compose.yml` file device value to be the absolute path of the folder with the Docker Compose file. For example:  \n\n```\nvolumes:\n  pc_data:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: \"C:\\\\Users\\\\IBM_Desktop\"\n```\n\nReplace the `C:\\\\Users\\\\IBM_Desktop` value with your directory path.\n\n#### For all platforms\n\nRun the following command:\n\n```bash\ncd <sample folder you created>\ndocker-compose up\n```\n\n#### Check the volumes\n\nWhen the Workflow Process Service Trial environment runs, data is persisted into Docker volumes that are automatically created by Docker Compose:\n- the `pc_data` volume persists the data and logs of the Liberty server running Workflow Process Service\n- the `postgres_data` volume persists the PostgreSQL data\n\nThere are different data volumes based on the Docker Compose setting. To list the volumes, run:\n\n```bash\ndocker volume ls\n```\n\n**Note:** You can retrieve the actual location of the volume on your Docker host file system by running:\n\n```bash\ndocker volume inspect <folder_name>_pc_data\n```\n\n#### Accessing the container runtime data and configuration \n\nWhen persistence is enabled, the container runtime data and configuration are written to the host computer, in the folder where Docker Compose was started. This location is called `<local_workspace>` in the following example.\n\nThe structure looks like this:\n\n```\n<local_workspace>\n     |--cert-trusted\n     |--tls\n         |--key.p12\n         |--trusts.p12\n     |--config\n         |--liberty-custom.xml\n         |--workflow-custom.xml\n         |--custom-registry.xml\n     |--env\n         |--server.env\n     |--data\n          |--messaging\n          |--index\n     |--output\n          |--logs    \n          |--dump\n```\n\n## Customizing the user registry\n\nWorkflow Process Service Authoring has predefined users and groups. You can update the users and groups if you have persistence enabled. The custom registry is under `<local_workspace>`:\n       `<local_workspace>/config/custom-registry.xml`\n\nUsernames and groups are listed in this file. If you update this file and don't restart the container, the changes are applied to the server runtime in about one minute.\n\nMake sure to use all-lowercase names for groups. Groups available in the registry are not immediately replicated to the product database. In order to use newly created groups, you can restart the environment or sign in as a user who is member of that group.\n\n## Enabling full text search and dashboard support\n\nTo access full text search, advanced filtering functions, and the Teams dashboard in Workplace, you must activate the IBM Process Federation Server (PFS) runtime, which requires Elasticsearch. The `docker-compose.yml` file will deploy an additional Docker container running Elasticsearch.\n\nFind the `docker-compose.yml` file here: \n\n  |    | No persistence | Persistence enabled |\n|---|---|---|\n| **PFS enabled** | [PFS/docker-compose.yml](https://github.com/icp4a/workflow-process-service-trial/blob/main/PFS/docker-compose.yml) | [persistence/PFS/docker-compose.yml](https://github.com/icp4a/workflow-process-service-trial/blob/main/persistence/PFS/docker-compose.yml)\n\nCopy the contents of the `docker-compose.yml` file under the `PFS/` folder or `persistence/PFS` folder into a new file named `docker-compose.yml` in the folder that you created.\n\n- For Workflow Process Service Trial with the optional Process Federation Server enabled:\n  ```bash\n  cd <your_pfs_yml_folder>/\n  docker-compose up\n  ```\n\nIf you already have an existing environment and you want to enable full text search and dashboard support:\n1. Update your existing `docker-compose.yml` file, and add the `elasticsearch` service from the `docker-compose.yml` file above to your existing file.\n2. Set the following environment variables in the `pc` service of your `docker-compose.yml` file:  \n\n  ``` \n        - PFS_ENABLE=true\n        - PFS_REMOTEELASTICSEARCH_ENDPOINTS=http://elasticsearch:9200\n  ```\n3. If persistence is enabled, declare the `elasticsearch_data` volume in the `volumes` section.\n\nWhen Process Federation Server is enabled and persistence is also enabled, the Elasticsearch data will be persisted in a volume named `elasticsearch_data`.\n\n **Note:** Running Elasticsearch in addition to the Workflow Process Service container might cause resource issues. See [Container exits with code 137](troubleshooting-docker#container-exits-with-code-137-or-outofmemoryerror).\n\n\n## Cleaning up the environment\n\nTo clean up the environment:\n1. Run the `docker-compose down` command to stop and delete the environment.\n2. If you persisted the data, delete all the volumes created by Workflow Process Service Trial. Use `docker volume ls` to check the status of the volumes.\n3. To delete the volumes, run: \n\n  ```bash\n  docker volume prune\n  ```\n\nAlternatively, you can delete them one at a time.\n\n- When Process Federation Server is not enabled:\n\n  ```bash\n  docker volume rm <basic_folder_name>_pc_data\n  docker volume rm <basic_folder_name>_postgres_data\n  ```\n\n- When Process Federation Server is enabled:\n\n  ```bash\n  docker volume rm <pfs_folder_name>_pc_data\n  docker volume rm <pfs_folder_name>_postgres_data\n  docker volume rm <pfs_folder_name>_elasticsearch_data\n  ```\n\n4. If you persisted the data, delete all the folders under your local workspace: `config`,`output`, `env`,`tls`,`cert-trusted` and `data`.  \n\n\n## Overriding the Liberty default configuration\n\nTo override the Liberty default configuration, you can provide your own Liberty configuration dropins. For more information, see [Using the configuration dropins folder to specify server configuration](https://www.ibm.com/docs/en/was-liberty/base?topic=files-using-configuration-dropins-folder-specify-server-configuration). Overriding is done by mounting configuration dropins in the form of XML files in the `/config/configDropins/overrides` folder. The `logging.xml` file is an example of a mounted file in `docker-compose.yml`. If you want to persist your data, edit the `liberty-custom.xml` file under the `./config` folder.\n\n## Integrating with external services\n\nTo integrate Workflow Process Service with an external service, you must exchange your TLS certificate with the external service. The certificates for Workflow Process Service must have either the `.pem` file format and a PEM encoded X509v3 certificate, or the `.crt` file format.\n\n1. Import the certificate of an external service.\n    1. Get the signer certificate that is used to sign into your external service and save it to a certificate. For more information, see [OpenSSL](https://www.openssl.org/). The following example commands use a certificate that is named `external-service-cert.crt.` The next example command gets the certificate chain of cloud.ibm.com by using OpenSSL:\n\n    ```bash\n    echo | openssl s_client -showcerts -connect cloud.ibm.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > external-service-cert.crt\n    ``` \n\n    The following example command gets the certificate chain of `cloud.ibm.com` by using keytool:\n\n    ```bash\n    keytool -printcert -sslserver cloud.ibm.com:443 -rfc > external-service-cert.crt\n    ```\n\n    2. Add the certificate to the trust list `cert-trusted/` by running the following command. The server must be running before you run this command.\n\n    ```bash\n    docker cp ./external-service-cert.crt pc:/shared/custom/cert-trusted\n    ```\n\n    3. Stop and restart your environment by running the following commands:\n\n    ```bash\n    docker-compose stop\n    docker-compose start\n    ```\n\n2. To export the root CA key and import it into the truststore of an external service, run the following command. The server must be running before you run this command.\n\n  ```bash\n  docker cp pc:/shared/custom/tls/ca_crt.pem .\n  ```\n","type":"Mdx","contentDigest":"d9009c0ae2b5be01208b2ead70ae9259","owner":"gatsby-plugin-mdx","counter":3703},"frontmatter":{"title":"Customizing Workflow Process Service Trial on Docker"},"exports":{},"rawBody":"---\ntitle: Customizing Workflow Process Service Trial on Docker\n---\n\n## Table of contents\n- [Customizing the hostname and port](#customizing-the-hostname-and-port)\n- [Changing the admin password](#changing-the-admin-password)\n- [Persisting your data](#persisting-your-data)\n- [Customizing the user registry](#customizing-the-user-registry)\n- [Enabling full text search and dashboard support](#enabling-full-text-search-and-dashboard-support)\n- [Cleaning up the environment](#cleaning-up-the-environment)\n- [Overriding the Liberty default configuration](#overriding-the-liberty-default-configuration)\n- [Integrating with external services](#integrating-with-external-services)\n\n\n## Customizing the hostname and port\n\nIf you want to access Workplace or Studio from a web browser that's not running on the Docker host, edit the  `docker-compose.yml` file to set the `EXTERNAL_HOSTNAME` environment variable to the actual IP or hostname of your Docker host. \n\nYou can also customize the external port used to expose the Workflow Process Service APIs. If you want to change the external port, you can't use localhost as the `EXTERNAL_HOSTNAME`. To change the external port, take both of these two actions:\n\n   1. Set the `EXTERNAL_HTTPS_PORT` environment variable in the `docker-compose.yml` file to the port number of your choice.\n   2. Change the host port declared in the `services.pc.ports` section to make it match the `EXTERNAL_HTTPS_PORT` environment variable value. \n   \n   For example, to set the host port to 7443:\n\n  ```\n  \n  [...]\n    pc:\n      [...]\n      ports:\n        - \"7443:9443\"\n      [...]\n      environment:\n      [...]\n        - EXTERNAL_HTTPS_PORT=7443\n  [...]\n  ```\n\n  The `EXTERNAL_HTTPS_PORT` is the first number under `ports` in the docker-compose.yml file:\n\n  ```\n  ports:\n        - \"7443:9443\"\n  ```\n\nAfter updating `EXTERNAL_HOSTNAME` or `EXTERNAL_HTTPS_PORT` in the `docker-compose.yml` file, if you already had an existing environment, follow these steps for the change to take effect:\n\n1. Run the  `docker-compose down` command to stop and delete the environment.\n2. If you are using persistent data, delete the `tls` folder in your workspace and `tls` folder under data/generated/ in your workspace.\n3. Run the  `docker-compose up` command to start the environment. \n\n**Note:** The container will use the same DNS server as the host computer, but the hostname and IP mappings in the /etc/hosts file won't be passed to the container automatically. If the hostname of your host machine is not added to the DNS server, you can configure the container to use the hostname and IP mappings by adding information similar to the following information in the docker-compose.yml file:\n\n  ```\n  #############################################################################################################\n  # The \"pc\" container is running the Workflow Process Service (authoring trial) image\n  #############################################################################################################\n  pc:\n    ...\n\n    extra_hosts:\n      - <hostname>:<host_ipaddress>\n  ```\n\n## Changing the admin password\n\nIf you don't want to use the default admin password for the Docker image, add the following line under the `environment` section in the `docker-compose yml` file before you start the environment:\n\n```    \n    - ADMIN_PASSWORD=<your_password>\n```\n\nReplace `<your_password>` with your new password. \n\n **Note:**  You can't change the admin username. \n\n#### Updating the admin password after starting\n\nTo update the admin password, you must restart the container because the Liberty server environment is not refreshed dynamically.\n\nIf you have an existing environment and you updated the `ADMIN_PASSWORD` variable in the `docker-compose.yml` file, complete the following steps:\n\n1. Run the `docker-compose down` command to stop and delete the environment.\n2. If you enabled persistence, find the `server.env` file under the env/ folder and delete the whole line that starts with `ADMIN_PASSWORD`.\n3. Run the  `docker-compose up` command to start the environment.\n\n## Persisting your data\n\nIf you want to save the data and the process when you delete the container instance, and reuse it when you run another container instance, you can persist the data. Copy the contents of the [docker-compose.yml](https://github.com/icp4a/workflow-process-service-trial/blob/main/persistence/basic/docker-compose.yml) file with persistence to your local computer.\n\n#### For Linux only\n\nIf you're running Linux and using Docker as your container engine, make sure the folder has read-write permission from the container. The container user ID is 50001 and it belongs to the root group, so to change the folder's permissions, run:\n\n```\nsudo chown 50001:0 <current_sample_folder>\n```\n\n **Note:**  Don't run this command on Mac. It's only needed for Linux.\n\n#### For Windows only\nEdit the `docker-compose.yml` file device value to be the absolute path of the folder with the Docker Compose file. For example:  \n\n```\nvolumes:\n  pc_data:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: \"C:\\\\Users\\\\IBM_Desktop\"\n```\n\nReplace the `C:\\\\Users\\\\IBM_Desktop` value with your directory path.\n\n#### For all platforms\n\nRun the following command:\n\n```bash\ncd <sample folder you created>\ndocker-compose up\n```\n\n#### Check the volumes\n\nWhen the Workflow Process Service Trial environment runs, data is persisted into Docker volumes that are automatically created by Docker Compose:\n- the `pc_data` volume persists the data and logs of the Liberty server running Workflow Process Service\n- the `postgres_data` volume persists the PostgreSQL data\n\nThere are different data volumes based on the Docker Compose setting. To list the volumes, run:\n\n```bash\ndocker volume ls\n```\n\n**Note:** You can retrieve the actual location of the volume on your Docker host file system by running:\n\n```bash\ndocker volume inspect <folder_name>_pc_data\n```\n\n#### Accessing the container runtime data and configuration \n\nWhen persistence is enabled, the container runtime data and configuration are written to the host computer, in the folder where Docker Compose was started. This location is called `<local_workspace>` in the following example.\n\nThe structure looks like this:\n\n```\n<local_workspace>\n     |--cert-trusted\n     |--tls\n         |--key.p12\n         |--trusts.p12\n     |--config\n         |--liberty-custom.xml\n         |--workflow-custom.xml\n         |--custom-registry.xml\n     |--env\n         |--server.env\n     |--data\n          |--messaging\n          |--index\n     |--output\n          |--logs    \n          |--dump\n```\n\n## Customizing the user registry\n\nWorkflow Process Service Authoring has predefined users and groups. You can update the users and groups if you have persistence enabled. The custom registry is under `<local_workspace>`:\n       `<local_workspace>/config/custom-registry.xml`\n\nUsernames and groups are listed in this file. If you update this file and don't restart the container, the changes are applied to the server runtime in about one minute.\n\nMake sure to use all-lowercase names for groups. Groups available in the registry are not immediately replicated to the product database. In order to use newly created groups, you can restart the environment or sign in as a user who is member of that group.\n\n## Enabling full text search and dashboard support\n\nTo access full text search, advanced filtering functions, and the Teams dashboard in Workplace, you must activate the IBM Process Federation Server (PFS) runtime, which requires Elasticsearch. The `docker-compose.yml` file will deploy an additional Docker container running Elasticsearch.\n\nFind the `docker-compose.yml` file here: \n\n  |    | No persistence | Persistence enabled |\n|---|---|---|\n| **PFS enabled** | [PFS/docker-compose.yml](https://github.com/icp4a/workflow-process-service-trial/blob/main/PFS/docker-compose.yml) | [persistence/PFS/docker-compose.yml](https://github.com/icp4a/workflow-process-service-trial/blob/main/persistence/PFS/docker-compose.yml)\n\nCopy the contents of the `docker-compose.yml` file under the `PFS/` folder or `persistence/PFS` folder into a new file named `docker-compose.yml` in the folder that you created.\n\n- For Workflow Process Service Trial with the optional Process Federation Server enabled:\n  ```bash\n  cd <your_pfs_yml_folder>/\n  docker-compose up\n  ```\n\nIf you already have an existing environment and you want to enable full text search and dashboard support:\n1. Update your existing `docker-compose.yml` file, and add the `elasticsearch` service from the `docker-compose.yml` file above to your existing file.\n2. Set the following environment variables in the `pc` service of your `docker-compose.yml` file:  \n\n  ``` \n        - PFS_ENABLE=true\n        - PFS_REMOTEELASTICSEARCH_ENDPOINTS=http://elasticsearch:9200\n  ```\n3. If persistence is enabled, declare the `elasticsearch_data` volume in the `volumes` section.\n\nWhen Process Federation Server is enabled and persistence is also enabled, the Elasticsearch data will be persisted in a volume named `elasticsearch_data`.\n\n **Note:** Running Elasticsearch in addition to the Workflow Process Service container might cause resource issues. See [Container exits with code 137](troubleshooting-docker#container-exits-with-code-137-or-outofmemoryerror).\n\n\n## Cleaning up the environment\n\nTo clean up the environment:\n1. Run the `docker-compose down` command to stop and delete the environment.\n2. If you persisted the data, delete all the volumes created by Workflow Process Service Trial. Use `docker volume ls` to check the status of the volumes.\n3. To delete the volumes, run: \n\n  ```bash\n  docker volume prune\n  ```\n\nAlternatively, you can delete them one at a time.\n\n- When Process Federation Server is not enabled:\n\n  ```bash\n  docker volume rm <basic_folder_name>_pc_data\n  docker volume rm <basic_folder_name>_postgres_data\n  ```\n\n- When Process Federation Server is enabled:\n\n  ```bash\n  docker volume rm <pfs_folder_name>_pc_data\n  docker volume rm <pfs_folder_name>_postgres_data\n  docker volume rm <pfs_folder_name>_elasticsearch_data\n  ```\n\n4. If you persisted the data, delete all the folders under your local workspace: `config`,`output`, `env`,`tls`,`cert-trusted` and `data`.  \n\n\n## Overriding the Liberty default configuration\n\nTo override the Liberty default configuration, you can provide your own Liberty configuration dropins. For more information, see [Using the configuration dropins folder to specify server configuration](https://www.ibm.com/docs/en/was-liberty/base?topic=files-using-configuration-dropins-folder-specify-server-configuration). Overriding is done by mounting configuration dropins in the form of XML files in the `/config/configDropins/overrides` folder. The `logging.xml` file is an example of a mounted file in `docker-compose.yml`. If you want to persist your data, edit the `liberty-custom.xml` file under the `./config` folder.\n\n## Integrating with external services\n\nTo integrate Workflow Process Service with an external service, you must exchange your TLS certificate with the external service. The certificates for Workflow Process Service must have either the `.pem` file format and a PEM encoded X509v3 certificate, or the `.crt` file format.\n\n1. Import the certificate of an external service.\n    1. Get the signer certificate that is used to sign into your external service and save it to a certificate. For more information, see [OpenSSL](https://www.openssl.org/). The following example commands use a certificate that is named `external-service-cert.crt.` The next example command gets the certificate chain of cloud.ibm.com by using OpenSSL:\n\n    ```bash\n    echo | openssl s_client -showcerts -connect cloud.ibm.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > external-service-cert.crt\n    ``` \n\n    The following example command gets the certificate chain of `cloud.ibm.com` by using keytool:\n\n    ```bash\n    keytool -printcert -sslserver cloud.ibm.com:443 -rfc > external-service-cert.crt\n    ```\n\n    2. Add the certificate to the trust list `cert-trusted/` by running the following command. The server must be running before you run this command.\n\n    ```bash\n    docker cp ./external-service-cert.crt pc:/shared/custom/cert-trusted\n    ```\n\n    3. Stop and restart your environment by running the following commands:\n\n    ```bash\n    docker-compose stop\n    docker-compose start\n    ```\n\n2. To export the root CA key and import it into the truststore of an external service, run the following command. The server must be running before you run this command.\n\n  ```bash\n  docker cp pc:/shared/custom/tls/ca_crt.pem .\n  ```\n","fileAbsolutePath":"/Users/aliceip/Documents/GitHub/workflow-process-service-trial/github-pages/src/pages/customizing-docker.mdx"}}},
    "staticQueryHashes": ["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}